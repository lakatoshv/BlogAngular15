/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Injectable, Optional } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { Http, Headers, Request, RequestMethod, RequestOptions } from '@angular/http';
import { interval, fromEvent } from 'rxjs';
import { share, pluck, filter } from 'rxjs/operators';
export class Angular2TokenService {
    /**
     * @param {?} http
     * @param {?} activatedRoute
     * @param {?} router
     */
    constructor(http, activatedRoute, router) {
        this.http = http;
        this.activatedRoute = activatedRoute;
        this.router = router;
    }
    /**
     * @return {?}
     */
    get currentUserType() {
        if (this.atCurrentUserType != null)
            return this.atCurrentUserType.name;
        else
            return null;
    }
    /**
     * @return {?}
     */
    get currentUserData() {
        return this.atCurrentUserData;
    }
    /**
     * @return {?}
     */
    get currentAuthData() {
        return this.atCurrentAuthData;
    }
    /**
     * @return {?}
     */
    get currentAuthHeaders() {
        if (this.atCurrentAuthData != null) {
            return new Headers({
                'access-token': this.atCurrentAuthData.accessToken,
                'client': this.atCurrentAuthData.client,
                'expiry': this.atCurrentAuthData.expiry,
                'token-type': this.atCurrentAuthData.tokenType,
                'uid': this.atCurrentAuthData.uid
            });
        }
        return new Headers;
    }
    /**
     * @return {?}
     */
    userSignedIn() {
        return !!this.atCurrentAuthData;
    }
    /**
     * @return {?}
     */
    canActivate() {
        if (this.userSignedIn())
            return true;
        else {
            // Store current location in storage (usefull for redirection after signing in)
            if (this.atOptions.signInStoredUrlStorageKey) {
                localStorage.setItem(this.atOptions.signInStoredUrlStorageKey, window.location.pathname + window.location.search);
            }
            // Redirect user to sign in if signInRedirect is set
            if (this.router && this.atOptions.signInRedirect)
                this.router.navigate([this.atOptions.signInRedirect]);
            return false;
        }
    }
    /**
     * @param {?=} options
     * @return {?}
     */
    init(options) {
        let /** @type {?} */ defaultOptions = {
            apiPath: null,
            apiBase: null,
            signInPath: 'auth/sign_in',
            signInRedirect: null,
            signInStoredUrlStorageKey: null,
            signOutPath: 'auth/sign_out',
            validateTokenPath: 'auth/validate_token',
            signOutFailedValidate: false,
            registerAccountPath: 'auth',
            deleteAccountPath: 'auth',
            registerAccountCallback: window.location.href,
            updatePasswordPath: 'auth',
            resetPasswordPath: 'auth/password',
            resetPasswordCallback: window.location.href,
            userTypes: null,
            oAuthBase: window.location.origin,
            oAuthPaths: {
                github: 'auth/github'
            },
            oAuthCallbackPath: 'oauth_callback',
            oAuthWindowType: 'newWindow',
            oAuthWindowOptions: null,
            globalOptions: {
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            }
        };
        this.atOptions = (/** @type {?} */ (Object)).assign(defaultOptions, options);
        this.tryLoadAuthData();
    }
    /**
     *
     * Actions
     *
     * @param {?} registerData
     * @return {?}
     */
    registerAccount(registerData) {
        if (registerData.userType == null)
            this.atCurrentUserType = null;
        else {
            this.atCurrentUserType = this.getUserTypeByName(registerData.userType);
            delete registerData.userType;
        }
        if (registerData["password_confirmation"] == null &&
            registerData.passwordConfirmation != null) {
            registerData["password_confirmation"] = registerData.passwordConfirmation;
            delete registerData.passwordConfirmation;
        }
        registerData["confirm_success_url"] = this.atOptions.registerAccountCallback;
        return this.post(this.getUserPath() + this.atOptions.registerAccountPath, JSON.stringify(registerData));
    }
    /**
     * @return {?}
     */
    deleteAccount() {
        return this.delete(this.getUserPath() + this.atOptions.deleteAccountPath);
    }
    /**
     * @param {?} signInData
     * @return {?}
     */
    signIn(signInData) {
        if (signInData.userType == null)
            this.atCurrentUserType = null;
        else
            this.atCurrentUserType = this.getUserTypeByName(signInData.userType);
        let /** @type {?} */ body = JSON.stringify({
            email: signInData.email,
            password: signInData.password
        });
        let /** @type {?} */ observ = this.post(this.getUserPath() + this.atOptions.signInPath, body);
        observ.subscribe(res => this.atCurrentUserData = res.json().data, _error => null);
        return observ;
    }
    /**
     * @param {?} oAuthType
     * @return {?}
     */
    signInOAuth(oAuthType) {
        let /** @type {?} */ oAuthPath = this.getOAuthPath(oAuthType);
        let /** @type {?} */ callbackUrl = `${window.location.origin}/${this.atOptions.oAuthCallbackPath}`;
        let /** @type {?} */ oAuthWindowType = this.atOptions.oAuthWindowType;
        let /** @type {?} */ authUrl = this.getOAuthUrl(oAuthPath, callbackUrl, oAuthWindowType);
        if (oAuthWindowType == 'newWindow') {
            let /** @type {?} */ oAuthWindowOptions = this.atOptions.oAuthWindowOptions;
            let /** @type {?} */ windowOptions = '';
            if (oAuthWindowOptions) {
                for (let /** @type {?} */ key in oAuthWindowOptions) {
                    windowOptions += `,${key}=${oAuthWindowOptions[key]}`;
                }
            }
            let /** @type {?} */ popup = window.open(authUrl, '_blank', `closebuttoncaption=Cancel${windowOptions}`);
            return this.requestCredentialsViaPostMessage(popup);
        }
        else if (oAuthWindowType == 'sameWindow') {
            window.location.href = authUrl;
        }
        else {
            throw `Unsupported oAuthWindowType "${oAuthWindowType}"`;
        }
    }
    /**
     * @return {?}
     */
    processOAuthCallback() {
        this.getAuthDataFromParams();
    }
    /**
     * @return {?}
     */
    signOut() {
        let /** @type {?} */ observ = this.delete(this.getUserPath() + this.atOptions.signOutPath);
        localStorage.removeItem('accessToken');
        localStorage.removeItem('client');
        localStorage.removeItem('expiry');
        localStorage.removeItem('tokenType');
        localStorage.removeItem('uid');
        this.atCurrentAuthData = null;
        this.atCurrentUserType = null;
        this.atCurrentUserData = null;
        return observ;
    }
    /**
     * @return {?}
     */
    validateToken() {
        let /** @type {?} */ observ = this.get(this.getUserPath() + this.atOptions.validateTokenPath);
        observ.subscribe(res => this.atCurrentUserData = res.json().data, error => {
            if (error.status === 401 && this.atOptions.signOutFailedValidate) {
                this.signOut();
            }
        });
        return observ;
    }
    /**
     * @param {?} updatePasswordData
     * @return {?}
     */
    updatePassword(updatePasswordData) {
        if (updatePasswordData.userType != null)
            this.atCurrentUserType = this.getUserTypeByName(updatePasswordData.userType);
        let /** @type {?} */ args;
        if (updatePasswordData.passwordCurrent == null) {
            args = {
                password: updatePasswordData.password,
                password_confirmation: updatePasswordData.passwordConfirmation
            };
        }
        else {
            args = {
                current_password: updatePasswordData.passwordCurrent,
                password: updatePasswordData.password,
                password_confirmation: updatePasswordData.passwordConfirmation
            };
        }
        if (updatePasswordData.resetPasswordToken) {
            args.reset_password_token = updatePasswordData.resetPasswordToken;
        }
        let /** @type {?} */ body = JSON.stringify(args);
        return this.put(this.getUserPath() + this.atOptions.updatePasswordPath, body);
    }
    /**
     * @param {?} resetPasswordData
     * @return {?}
     */
    resetPassword(resetPasswordData) {
        if (resetPasswordData.userType == null)
            this.atCurrentUserType = null;
        else
            this.atCurrentUserType = this.getUserTypeByName(resetPasswordData.userType);
        let /** @type {?} */ body = JSON.stringify({
            email: resetPasswordData.email,
            redirect_url: this.atOptions.resetPasswordCallback
        });
        return this.post(this.getUserPath() + this.atOptions.resetPasswordPath, body);
    }
    /**
     *
     * HTTP Wrappers
     *
     * @param {?} url
     * @param {?=} options
     * @return {?}
     */
    get(url, options) {
        return this.request(this.mergeRequestOptionsArgs({
            url: this.getApiPath() + url,
            method: RequestMethod.Get
        }, options));
    }
    /**
     * @param {?} url
     * @param {?} body
     * @param {?=} options
     * @return {?}
     */
    post(url, body, options) {
        return this.request(this.mergeRequestOptionsArgs({
            url: this.getApiPath() + url,
            method: RequestMethod.Post,
            body: body
        }, options));
    }
    /**
     * @param {?} url
     * @param {?} body
     * @param {?=} options
     * @return {?}
     */
    put(url, body, options) {
        return this.request(this.mergeRequestOptionsArgs({
            url: this.getApiPath() + url,
            method: RequestMethod.Put,
            body: body
        }, options));
    }
    /**
     * @param {?} url
     * @param {?=} options
     * @return {?}
     */
    delete(url, options) {
        return this.request(this.mergeRequestOptionsArgs({
            url: this.getApiPath() + url,
            method: RequestMethod.Delete
        }, options));
    }
    /**
     * @param {?} url
     * @param {?} body
     * @param {?=} options
     * @return {?}
     */
    patch(url, body, options) {
        return this.request(this.mergeRequestOptionsArgs({
            url: this.getApiPath() + url,
            method: RequestMethod.Patch,
            body: body
        }, options));
    }
    /**
     * @param {?} path
     * @param {?=} options
     * @return {?}
     */
    head(path, options) {
        return this.request({
            method: RequestMethod.Head,
            url: this.getApiPath() + path
        });
    }
    /**
     * @param {?} url
     * @param {?=} options
     * @return {?}
     */
    options(url, options) {
        return this.request(this.mergeRequestOptionsArgs({
            url: this.getApiPath() + url,
            method: RequestMethod.Options
        }, options));
    }
    /**
     * @param {?} options
     * @return {?}
     */
    request(options) {
        let /** @type {?} */ baseRequestOptions;
        let /** @type {?} */ baseHeaders = this.atOptions.globalOptions.headers;
        // Get auth data from local storage
        this.getAuthDataFromStorage();
        // Merge auth headers to request if set
        if (this.atCurrentAuthData != null) {
            (/** @type {?} */ (Object)).assign(baseHeaders, {
                'access-token': this.atCurrentAuthData.accessToken,
                'client': this.atCurrentAuthData.client,
                'expiry': this.atCurrentAuthData.expiry,
                'token-type': this.atCurrentAuthData.tokenType,
                'uid': this.atCurrentAuthData.uid
            });
        }
        baseRequestOptions = new RequestOptions({
            headers: new Headers(baseHeaders)
        });
        // Merge standard and custom RequestOptions
        baseRequestOptions = baseRequestOptions.merge(options);
        let /** @type {?} */ response = this.http.request(new Request(baseRequestOptions)).pipe(share());
        this.handleResponse(response);
        return response;
    }
    /**
     * @param {?} options
     * @param {?=} addOptions
     * @return {?}
     */
    mergeRequestOptionsArgs(options, addOptions) {
        let /** @type {?} */ returnOptions = options;
        if (options)
            (/** @type {?} */ (Object)).assign(returnOptions, addOptions);
        return returnOptions;
    }
    /**
     * @param {?} response
     * @return {?}
     */
    handleResponse(response) {
        response.subscribe(res => {
            this.getAuthHeadersFromResponse(/** @type {?} */ (res));
        }, error => {
            this.getAuthHeadersFromResponse(/** @type {?} */ (error));
        });
    }
    /**
     *
     * Get Auth Data
     *
     * @return {?}
     */
    tryLoadAuthData() {
        let /** @type {?} */ userType = this.getUserTypeByName(localStorage.getItem('userType'));
        if (userType)
            this.atCurrentUserType = userType;
        this.getAuthDataFromStorage();
        if (this.activatedRoute)
            this.getAuthDataFromParams();
        if (this.atCurrentAuthData)
            this.validateToken();
    }
    /**
     * @param {?} data
     * @return {?}
     */
    getAuthHeadersFromResponse(data) {
        let /** @type {?} */ headers = data.headers;
        let /** @type {?} */ authData = {
            accessToken: headers.get('access-token'),
            client: headers.get('client'),
            expiry: headers.get('expiry'),
            tokenType: headers.get('token-type'),
            uid: headers.get('uid')
        };
        this.setAuthData(authData);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    getAuthDataFromPostMessage(data) {
        let /** @type {?} */ authData = {
            accessToken: data['auth_token'],
            client: data['client_id'],
            expiry: data['expiry'],
            tokenType: 'Bearer',
            uid: data['uid']
        };
        this.setAuthData(authData);
    }
    /**
     * @return {?}
     */
    getAuthDataFromStorage() {
        let /** @type {?} */ authData = {
            accessToken: localStorage.getItem('accessToken'),
            client: localStorage.getItem('client'),
            expiry: localStorage.getItem('expiry'),
            tokenType: localStorage.getItem('tokenType'),
            uid: localStorage.getItem('uid')
        };
        if (this.checkAuthData(authData))
            this.atCurrentAuthData = authData;
    }
    /**
     * @return {?}
     */
    getAuthDataFromParams() {
        if (this.activatedRoute.queryParams)
            // Fix for Testing, needs to be removed later
            this.activatedRoute.queryParams.subscribe(queryParams => {
                let /** @type {?} */ authData = {
                    accessToken: queryParams['token'] || queryParams['auth_token'],
                    client: queryParams['client_id'],
                    expiry: queryParams['expiry'],
                    tokenType: 'Bearer',
                    uid: queryParams['uid']
                };
                if (this.checkAuthData(authData))
                    this.atCurrentAuthData = authData;
            });
    }
    /**
     *
     * Set Auth Data
     *
     * @param {?} authData
     * @return {?}
     */
    setAuthData(authData) {
        if (this.checkAuthData(authData)) {
            this.atCurrentAuthData = authData;
            localStorage.setItem('accessToken', authData.accessToken);
            localStorage.setItem('client', authData.client);
            localStorage.setItem('expiry', authData.expiry);
            localStorage.setItem('tokenType', authData.tokenType);
            localStorage.setItem('uid', authData.uid);
            if (this.atCurrentUserType != null)
                localStorage.setItem('userType', this.atCurrentUserType.name);
        }
    }
    /**
     *
     * Validate Auth Data
     *
     * @param {?} authData
     * @return {?}
     */
    checkAuthData(authData) {
        if (authData.accessToken != null &&
            authData.client != null &&
            authData.expiry != null &&
            authData.tokenType != null &&
            authData.uid != null) {
            if (this.atCurrentAuthData != null)
                return authData.expiry >= this.atCurrentAuthData.expiry;
            else
                return true;
        }
        else {
            return false;
        }
    }
    /**
     *
     * Construct Paths / Urls
     *
     * @return {?}
     */
    getUserPath() {
        if (this.atCurrentUserType == null)
            return '';
        else
            return this.atCurrentUserType.path + '/';
    }
    /**
     * @return {?}
     */
    getApiPath() {
        let /** @type {?} */ constructedPath = '';
        if (this.atOptions.apiBase != null)
            constructedPath += this.atOptions.apiBase + '/';
        if (this.atOptions.apiPath != null)
            constructedPath += this.atOptions.apiPath + '/';
        return constructedPath;
    }
    /**
     * @param {?} oAuthType
     * @return {?}
     */
    getOAuthPath(oAuthType) {
        let /** @type {?} */ oAuthPath;
        oAuthPath = this.atOptions.oAuthPaths[oAuthType];
        if (oAuthPath == null)
            oAuthPath = `/auth/${oAuthType}`;
        return oAuthPath;
    }
    /**
     * @param {?} oAuthPath
     * @param {?} callbackUrl
     * @param {?} windowType
     * @return {?}
     */
    getOAuthUrl(oAuthPath, callbackUrl, windowType) {
        let /** @type {?} */ url;
        url = `${this.atOptions.oAuthBase}/${oAuthPath}`;
        url += `?omniauth_window_type=${windowType}`;
        url += `&auth_origin_url=${encodeURIComponent(callbackUrl)}`;
        if (this.atCurrentUserType != null)
            url += `&resource_class=${this.atCurrentUserType.name}`;
        return url;
    }
    /**
     *
     * OAuth
     *
     * @param {?} authWindow
     * @return {?}
     */
    requestCredentialsViaPostMessage(authWindow) {
        let /** @type {?} */ pollerObserv = interval(500);
        let /** @type {?} */ responseObserv = fromEvent(window, 'message').pipe(pluck('data'), filter(this.oAuthWindowResponseFilter));
        let /** @type {?} */ responseSubscription = responseObserv.subscribe(this.getAuthDataFromPostMessage.bind(this));
        let /** @type {?} */ pollerSubscription = pollerObserv.subscribe(() => {
            if (authWindow.closed)
                pollerSubscription.unsubscribe();
            else
                authWindow.postMessage('requestCredentials', '*');
        });
        return responseObserv;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    oAuthWindowResponseFilter(data) {
        if (data.message == 'deliverCredentials' || data.message == 'authFailure')
            return data;
    }
    /**
     *
     * Utilities
     *
     * @param {?} name
     * @return {?}
     */
    getUserTypeByName(name) {
        if (name == null || this.atOptions.userTypes == null)
            return null;
        return this.atOptions.userTypes.find(userType => userType.name === name);
    }
}
Angular2TokenService.decorators = [
    { type: Injectable },
];
/** @nocollapse */
Angular2TokenService.ctorParameters = () => [
    { type: Http },
    { type: ActivatedRoute, decorators: [{ type: Optional }] },
    { type: Router, decorators: [{ type: Optional }] }
];
function Angular2TokenService_tsickle_Closure_declarations() {
    /** @type {?} */
    Angular2TokenService.prototype.atOptions;
    /** @type {?} */
    Angular2TokenService.prototype.atCurrentUserType;
    /** @type {?} */
    Angular2TokenService.prototype.atCurrentAuthData;
    /** @type {?} */
    Angular2TokenService.prototype.atCurrentUserData;
    /** @type {?} */
    Angular2TokenService.prototype.http;
    /** @type {?} */
    Angular2TokenService.prototype.activatedRoute;
    /** @type {?} */
    Angular2TokenService.prototype.router;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhcjItdG9rZW4uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXIyLXRva2VuLyIsInNvdXJjZXMiOlsiYW5ndWxhcjItdG9rZW4uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQWUsTUFBTSxpQkFBaUIsQ0FBQztBQUN0RSxPQUFPLEVBQ0gsSUFBSSxFQUVKLE9BQU8sRUFDUCxPQUFPLEVBQ1AsYUFBYSxFQUNiLGNBQWMsRUFFakIsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFjLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkQsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFnQnRELE1BQU07Ozs7OztJQW9DRixZQUNZLE1BQ1ksY0FBOEIsRUFDOUIsTUFBYztRQUYxQixTQUFJLEdBQUosSUFBSTtRQUNRLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixXQUFNLEdBQU4sTUFBTSxDQUFRO0tBQ2pDOzs7O0lBdENMLElBQUksZUFBZTtRQUNmLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsSUFBSSxJQUFJLENBQUM7WUFDL0IsTUFBTSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUM7UUFDdkMsSUFBSTtZQUNBLE1BQU0sQ0FBQyxJQUFJLENBQUM7S0FDbkI7Ozs7SUFFRCxJQUFJLGVBQWU7UUFDZixNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDO0tBQ2pDOzs7O0lBRUQsSUFBSSxlQUFlO1FBQ2YsTUFBTSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztLQUNqQzs7OztJQUVELElBQUksa0JBQWtCO1FBQ2xCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBQztnQkFDZixjQUFjLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVc7Z0JBQ2xELFFBQVEsRUFBUSxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTTtnQkFDN0MsUUFBUSxFQUFRLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNO2dCQUM3QyxZQUFZLEVBQUksSUFBSSxDQUFDLGlCQUFpQixDQUFDLFNBQVM7Z0JBQ2hELEtBQUssRUFBVyxJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRzthQUM3QyxDQUFDLENBQUM7U0FDTjtRQUVELE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBQztLQUN0Qjs7OztJQWFELFlBQVk7UUFDUixNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztLQUNuQzs7OztJQUVELFdBQVc7UUFDUCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDcEIsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNoQixJQUFJLENBQUMsQ0FBQzs7WUFFRixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLHlCQUF5QixDQUFDLENBQUMsQ0FBQztnQkFDM0MsWUFBWSxDQUFDLE9BQU8sQ0FDaEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyx5QkFBeUIsRUFDeEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQ3BELENBQUM7YUFDTDs7WUFHRCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDO2dCQUM1QyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUUxRCxNQUFNLENBQUMsS0FBSyxDQUFDO1NBQ2hCO0tBQ0o7Ozs7O0lBR0QsSUFBSSxDQUFDLE9BQThCO1FBRS9CLHFCQUFJLGNBQWMsR0FBeUI7WUFDdkMsT0FBTyxFQUFxQixJQUFJO1lBQ2hDLE9BQU8sRUFBcUIsSUFBSTtZQUVoQyxVQUFVLEVBQWtCLGNBQWM7WUFDMUMsY0FBYyxFQUFjLElBQUk7WUFDaEMseUJBQXlCLEVBQUcsSUFBSTtZQUVoQyxXQUFXLEVBQWlCLGVBQWU7WUFDM0MsaUJBQWlCLEVBQVcscUJBQXFCO1lBQ2pELHFCQUFxQixFQUFPLEtBQUs7WUFFakMsbUJBQW1CLEVBQVMsTUFBTTtZQUNsQyxpQkFBaUIsRUFBVyxNQUFNO1lBQ2xDLHVCQUF1QixFQUFLLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSTtZQUVoRCxrQkFBa0IsRUFBVSxNQUFNO1lBRWxDLGlCQUFpQixFQUFXLGVBQWU7WUFDM0MscUJBQXFCLEVBQU8sTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJO1lBRWhELFNBQVMsRUFBbUIsSUFBSTtZQUVoQyxTQUFTLEVBQW1CLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTTtZQUNsRCxVQUFVLEVBQUU7Z0JBQ1IsTUFBTSxFQUFrQixhQUFhO2FBQ3hDO1lBQ0QsaUJBQWlCLEVBQVcsZ0JBQWdCO1lBQzVDLGVBQWUsRUFBYSxXQUFXO1lBQ3ZDLGtCQUFrQixFQUFVLElBQUk7WUFFaEMsYUFBYSxFQUFFO2dCQUNYLE9BQU8sRUFBRTtvQkFDTCxjQUFjLEVBQUUsa0JBQWtCO29CQUNsQyxRQUFRLEVBQVEsa0JBQWtCO2lCQUNyQzthQUNKO1NBQ0osQ0FBQztRQUVGLElBQUksQ0FBQyxTQUFTLEdBQUcsbUJBQU0sTUFBTSxFQUFDLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUUvRCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7S0FDMUI7Ozs7Ozs7O0lBU0QsZUFBZSxDQUFDLFlBQTBCO1FBRXRDLEVBQUUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDO1lBQzlCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUM7UUFDbEMsSUFBSSxDQUFDLENBQUM7WUFDRixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN2RSxPQUFPLFlBQVksQ0FBQyxRQUFRLENBQUM7U0FDaEM7UUFFRCxFQUFFLENBQUMsQ0FDQyxZQUFZLDZCQUEwQixJQUFJO1lBQzFDLFlBQVksQ0FBQyxvQkFBb0IsSUFBSSxJQUN6QyxDQUFDLENBQUMsQ0FBQztZQUNDLFlBQVksNEJBQTBCLFlBQVksQ0FBQyxvQkFBb0IsQ0FBQztZQUN4RSxPQUFPLFlBQVksQ0FBQyxvQkFBb0IsQ0FBQztTQUM1QztRQUVELFlBQVksMEJBQTBCLElBQUksQ0FBQyxTQUFTLENBQUMsdUJBQXVCLENBQUM7UUFFN0UsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO0tBQzNHOzs7O0lBR0QsYUFBYTtRQUNULE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDLENBQUM7S0FDN0U7Ozs7O0lBR0QsTUFBTSxDQUFDLFVBQXNCO1FBRXpCLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDO1lBQzVCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUM7UUFDbEMsSUFBSTtZQUNBLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRXpFLHFCQUFJLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ3RCLEtBQUssRUFBTyxVQUFVLENBQUMsS0FBSztZQUM1QixRQUFRLEVBQUksVUFBVSxDQUFDLFFBQVE7U0FDbEMsQ0FBQyxDQUFDO1FBRUgscUJBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRTdFLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRWxGLE1BQU0sQ0FBQyxNQUFNLENBQUM7S0FDakI7Ozs7O0lBRUQsV0FBVyxDQUFDLFNBQWlCO1FBRXpCLHFCQUFJLFNBQVMsR0FBVyxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3JELHFCQUFJLFdBQVcsR0FBVyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUMxRixxQkFBSSxlQUFlLEdBQVcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUM7UUFDN0QscUJBQUksT0FBTyxHQUFXLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxFQUFFLFdBQVcsRUFBRSxlQUFlLENBQUMsQ0FBQztRQUVoRixFQUFFLENBQUMsQ0FBQyxlQUFlLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNqQyxxQkFBSSxrQkFBa0IsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDO1lBQzNELHFCQUFJLGFBQWEsR0FBRyxFQUFFLENBQUM7WUFFdkIsRUFBRSxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixHQUFHLENBQUMsQ0FBQyxxQkFBSSxHQUFHLElBQUksa0JBQWtCLENBQUMsQ0FBQyxDQUFDO29CQUNqQyxhQUFhLElBQUksSUFBSSxHQUFHLElBQUksa0JBQWtCLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztpQkFDekQ7YUFDSjtZQUVELHFCQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsSUFBSSxDQUNuQixPQUFPLEVBQ1AsUUFBUSxFQUNSLDRCQUE0QixhQUFhLEVBQUUsQ0FDOUMsQ0FBQztZQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDdkQ7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsZUFBZSxJQUFJLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDekMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDO1NBQ2xDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixNQUFNLGdDQUFnQyxlQUFlLEdBQUcsQ0FBQztTQUM1RDtLQUNKOzs7O0lBRUQsb0JBQW9CO1FBQ2hCLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0tBQ2hDOzs7O0lBR0QsT0FBTztRQUNILHFCQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRTFFLFlBQVksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDdkMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsQyxZQUFZLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2xDLFlBQVksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDckMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUUvQixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO1FBQzlCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUM7UUFDOUIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQztRQUU5QixNQUFNLENBQUMsTUFBTSxDQUFDO0tBQ2pCOzs7O0lBR0QsYUFBYTtRQUNULHFCQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFFN0UsTUFBTSxDQUFDLFNBQVMsQ0FDWixHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxFQUMvQyxLQUFLLENBQUMsRUFBRTtZQUNKLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLEtBQUssR0FBRyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO2dCQUMvRCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7YUFDbEI7U0FDSixDQUFDLENBQUM7UUFFUCxNQUFNLENBQUMsTUFBTSxDQUFDO0tBQ2pCOzs7OztJQUdELGNBQWMsQ0FBQyxrQkFBc0M7UUFFakQsRUFBRSxDQUFDLENBQUMsa0JBQWtCLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQztZQUNwQyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRWpGLHFCQUFJLElBQVMsQ0FBQztRQUVkLEVBQUUsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLGVBQWUsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzdDLElBQUksR0FBRztnQkFDSCxRQUFRLEVBQWdCLGtCQUFrQixDQUFDLFFBQVE7Z0JBQ25ELHFCQUFxQixFQUFHLGtCQUFrQixDQUFDLG9CQUFvQjthQUNsRSxDQUFBO1NBQ0o7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNKLElBQUksR0FBRztnQkFDSCxnQkFBZ0IsRUFBUSxrQkFBa0IsQ0FBQyxlQUFlO2dCQUMxRCxRQUFRLEVBQWdCLGtCQUFrQixDQUFDLFFBQVE7Z0JBQ25ELHFCQUFxQixFQUFHLGtCQUFrQixDQUFDLG9CQUFvQjthQUNsRSxDQUFDO1NBQ0w7UUFFRCxFQUFFLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7WUFDeEMsSUFBSSxDQUFDLG9CQUFvQixHQUFHLGtCQUFrQixDQUFDLGtCQUFrQixDQUFDO1NBQ3JFO1FBRUQscUJBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLENBQUM7S0FDakY7Ozs7O0lBR0QsYUFBYSxDQUFDLGlCQUFvQztRQUU5QyxFQUFFLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDO1lBQ25DLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUM7UUFDbEMsSUFBSTtZQUNBLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFaEYscUJBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7WUFDdEIsS0FBSyxFQUFXLGlCQUFpQixDQUFDLEtBQUs7WUFDdkMsWUFBWSxFQUFJLElBQUksQ0FBQyxTQUFTLENBQUMscUJBQXFCO1NBQ3ZELENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxDQUFDO0tBQ2pGOzs7Ozs7Ozs7SUFRRCxHQUFHLENBQUMsR0FBVyxFQUFFLE9BQTRCO1FBQ3pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQztZQUM3QyxHQUFHLEVBQUssSUFBSSxDQUFDLFVBQVUsRUFBRSxHQUFHLEdBQUc7WUFDL0IsTUFBTSxFQUFFLGFBQWEsQ0FBQyxHQUFHO1NBQzVCLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztLQUNoQjs7Ozs7OztJQUVELElBQUksQ0FBQyxHQUFXLEVBQUUsSUFBUyxFQUFFLE9BQTRCO1FBQ3JELE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQztZQUM3QyxHQUFHLEVBQUssSUFBSSxDQUFDLFVBQVUsRUFBRSxHQUFHLEdBQUc7WUFDL0IsTUFBTSxFQUFFLGFBQWEsQ0FBQyxJQUFJO1lBQzFCLElBQUksRUFBSSxJQUFJO1NBQ2YsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0tBQ2hCOzs7Ozs7O0lBRUQsR0FBRyxDQUFDLEdBQVcsRUFBRSxJQUFTLEVBQUUsT0FBNEI7UUFDcEQsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDO1lBQzdDLEdBQUcsRUFBSyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsR0FBRztZQUMvQixNQUFNLEVBQUUsYUFBYSxDQUFDLEdBQUc7WUFDekIsSUFBSSxFQUFJLElBQUk7U0FDZixFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7S0FDaEI7Ozs7OztJQUVELE1BQU0sQ0FBQyxHQUFXLEVBQUUsT0FBNEI7UUFDNUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDO1lBQzdDLEdBQUcsRUFBSyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsR0FBRztZQUMvQixNQUFNLEVBQUUsYUFBYSxDQUFDLE1BQU07U0FDL0IsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0tBQ2hCOzs7Ozs7O0lBRUQsS0FBSyxDQUFDLEdBQVcsRUFBRSxJQUFTLEVBQUUsT0FBNEI7UUFDdEQsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDO1lBQzdDLEdBQUcsRUFBSyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsR0FBRztZQUMvQixNQUFNLEVBQUUsYUFBYSxDQUFDLEtBQUs7WUFDM0IsSUFBSSxFQUFJLElBQUk7U0FDZixFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7S0FDaEI7Ozs7OztJQUVELElBQUksQ0FBQyxJQUFZLEVBQUUsT0FBNEI7UUFDM0MsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDaEIsTUFBTSxFQUFFLGFBQWEsQ0FBQyxJQUFJO1lBQzFCLEdBQUcsRUFBSyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsSUFBSTtTQUNuQyxDQUFDLENBQUM7S0FDTjs7Ozs7O0lBRUQsT0FBTyxDQUFDLEdBQVcsRUFBRSxPQUE0QjtRQUM3QyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUM7WUFDN0MsR0FBRyxFQUFLLElBQUksQ0FBQyxVQUFVLEVBQUUsR0FBRyxHQUFHO1lBQy9CLE1BQU0sRUFBRSxhQUFhLENBQUMsT0FBTztTQUNoQyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7S0FDaEI7Ozs7O0lBR0QsT0FBTyxDQUFDLE9BQTJCO1FBRS9CLHFCQUFJLGtCQUFrQyxDQUFDO1FBQ3ZDLHFCQUFJLFdBQVcsR0FBcUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDOztRQUd6RixJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQzs7UUFHOUIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDakMsbUJBQU0sTUFBTSxFQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRTtnQkFDOUIsY0FBYyxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXO2dCQUNsRCxRQUFRLEVBQVEsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU07Z0JBQzdDLFFBQVEsRUFBUSxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTTtnQkFDN0MsWUFBWSxFQUFJLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTO2dCQUNoRCxLQUFLLEVBQVcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUc7YUFDN0MsQ0FBQyxDQUFDO1NBQ047UUFFRCxrQkFBa0IsR0FBRyxJQUFJLGNBQWMsQ0FBQztZQUNwQyxPQUFPLEVBQUUsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUFDO1NBQ3BDLENBQUMsQ0FBQzs7UUFHSCxrQkFBa0IsR0FBRyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFdkQscUJBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUNoRixJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRTlCLE1BQU0sQ0FBQyxRQUFRLENBQUM7S0FDbkI7Ozs7OztJQUVPLHVCQUF1QixDQUFDLE9BQTJCLEVBQUUsVUFBK0I7UUFFeEYscUJBQUksYUFBYSxHQUF1QixPQUFPLENBQUM7UUFFaEQsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ1IsbUJBQU0sTUFBTSxFQUFDLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxVQUFVLENBQUMsQ0FBQztRQUVwRCxNQUFNLENBQUMsYUFBYSxDQUFDOzs7Ozs7SUFJakIsY0FBYyxDQUFDLFFBQThCO1FBQ2pELFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDckIsSUFBSSxDQUFDLDBCQUEwQixtQkFBTSxHQUFHLEVBQUMsQ0FBQztTQUM3QyxFQUFFLEtBQUssQ0FBQyxFQUFFO1lBQ1AsSUFBSSxDQUFDLDBCQUEwQixtQkFBTSxLQUFLLEVBQUMsQ0FBQztTQUMvQyxDQUFDLENBQUM7Ozs7Ozs7O0lBVUMsZUFBZTtRQUVuQixxQkFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUV4RSxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUM7WUFDVCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsUUFBUSxDQUFDO1FBRXRDLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1FBRTlCLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUM7WUFDbkIsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFFakMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDO1lBQ3ZCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQzs7Ozs7O0lBSXJCLDBCQUEwQixDQUFDLElBQVM7UUFDeEMscUJBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFFM0IscUJBQUksUUFBUSxHQUFhO1lBQ3JCLFdBQVcsRUFBSyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQztZQUMzQyxNQUFNLEVBQVUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUM7WUFDckMsTUFBTSxFQUFVLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDO1lBQ3JDLFNBQVMsRUFBTyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQztZQUN6QyxHQUFHLEVBQWEsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUM7U0FDckMsQ0FBQztRQUVGLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7Ozs7OztJQUl2QiwwQkFBMEIsQ0FBQyxJQUFTO1FBQ3hDLHFCQUFJLFFBQVEsR0FBYTtZQUNyQixXQUFXLEVBQUssSUFBSSxDQUFDLFlBQVksQ0FBQztZQUNsQyxNQUFNLEVBQVUsSUFBSSxDQUFDLFdBQVcsQ0FBQztZQUNqQyxNQUFNLEVBQVUsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUM5QixTQUFTLEVBQU8sUUFBUTtZQUN4QixHQUFHLEVBQWEsSUFBSSxDQUFDLEtBQUssQ0FBQztTQUM5QixDQUFDO1FBRUYsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQzs7Ozs7SUFJdkIsc0JBQXNCO1FBRTFCLHFCQUFJLFFBQVEsR0FBYTtZQUNyQixXQUFXLEVBQUssWUFBWSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUM7WUFDbkQsTUFBTSxFQUFVLFlBQVksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO1lBQzlDLE1BQU0sRUFBVSxZQUFZLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztZQUM5QyxTQUFTLEVBQU8sWUFBWSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7WUFDakQsR0FBRyxFQUFhLFlBQVksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO1NBQzlDLENBQUM7UUFFRixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzdCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxRQUFRLENBQUM7Ozs7O0lBSWxDLHFCQUFxQjtRQUN6QixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQzs7WUFDL0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxFQUFFO2dCQUNwRCxxQkFBSSxRQUFRLEdBQWE7b0JBQ3JCLFdBQVcsRUFBSyxXQUFXLENBQUMsT0FBTyxDQUFDLElBQUksV0FBVyxDQUFDLFlBQVksQ0FBQztvQkFDakUsTUFBTSxFQUFVLFdBQVcsQ0FBQyxXQUFXLENBQUM7b0JBQ3hDLE1BQU0sRUFBVSxXQUFXLENBQUMsUUFBUSxDQUFDO29CQUNyQyxTQUFTLEVBQU8sUUFBUTtvQkFDeEIsR0FBRyxFQUFhLFdBQVcsQ0FBQyxLQUFLLENBQUM7aUJBQ3JDLENBQUM7Z0JBRUYsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDN0IsSUFBSSxDQUFDLGlCQUFpQixHQUFHLFFBQVEsQ0FBQzthQUN6QyxDQUFDLENBQUM7Ozs7Ozs7OztJQVVILFdBQVcsQ0FBQyxRQUFrQjtRQUVsQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUUvQixJQUFJLENBQUMsaUJBQWlCLEdBQUcsUUFBUSxDQUFDO1lBRWxDLFlBQVksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUMxRCxZQUFZLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDaEQsWUFBWSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2hELFlBQVksQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN0RCxZQUFZLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFMUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQztnQkFDL0IsWUFBWSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1NBRXJFOzs7Ozs7Ozs7SUFVRyxhQUFhLENBQUMsUUFBa0I7UUFFcEMsRUFBRSxDQUFDLENBQ0MsUUFBUSxDQUFDLFdBQVcsSUFBSSxJQUFJO1lBQzVCLFFBQVEsQ0FBQyxNQUFNLElBQUksSUFBSTtZQUN2QixRQUFRLENBQUMsTUFBTSxJQUFJLElBQUk7WUFDdkIsUUFBUSxDQUFDLFNBQVMsSUFBSSxJQUFJO1lBQzFCLFFBQVEsQ0FBQyxHQUFHLElBQUksSUFDcEIsQ0FBQyxDQUFDLENBQUM7WUFDQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDO2dCQUMvQixNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDO1lBQzVELElBQUk7Z0JBQ0EsTUFBTSxDQUFDLElBQUksQ0FBQztTQUNuQjtRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ0osTUFBTSxDQUFDLEtBQUssQ0FBQztTQUNoQjs7Ozs7Ozs7SUFTRyxXQUFXO1FBQ2YsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQztZQUMvQixNQUFNLENBQUMsRUFBRSxDQUFDO1FBQ2QsSUFBSTtZQUNBLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQzs7Ozs7SUFHekMsVUFBVTtRQUNkLHFCQUFJLGVBQWUsR0FBRyxFQUFFLENBQUM7UUFFekIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDO1lBQy9CLGVBQWUsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7UUFFcEQsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDO1lBQy9CLGVBQWUsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7UUFFcEQsTUFBTSxDQUFDLGVBQWUsQ0FBQzs7Ozs7O0lBR25CLFlBQVksQ0FBQyxTQUFpQjtRQUNsQyxxQkFBSSxTQUFpQixDQUFDO1FBRXRCLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVqRCxFQUFFLENBQUMsQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDO1lBQ2xCLFNBQVMsR0FBRyxTQUFTLFNBQVMsRUFBRSxDQUFDO1FBRXJDLE1BQU0sQ0FBQyxTQUFTLENBQUM7Ozs7Ozs7O0lBR2IsV0FBVyxDQUFDLFNBQWlCLEVBQUUsV0FBbUIsRUFBRSxVQUFrQjtRQUMxRSxxQkFBSSxHQUFXLENBQUM7UUFFaEIsR0FBRyxHQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLElBQUksU0FBUyxFQUFFLENBQUM7UUFDbkQsR0FBRyxJQUFLLHlCQUF5QixVQUFVLEVBQUUsQ0FBQztRQUM5QyxHQUFHLElBQUssb0JBQW9CLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7UUFFOUQsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQztZQUMvQixHQUFHLElBQUksbUJBQW1CLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUU1RCxNQUFNLENBQUMsR0FBRyxDQUFDOzs7Ozs7Ozs7SUFTUCxnQ0FBZ0MsQ0FBQyxVQUFlO1FBQ3BELHFCQUFJLFlBQVksR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFakMscUJBQUksY0FBYyxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUNsRCxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQ2IsTUFBTSxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUN6QyxDQUFDO1FBRUYscUJBQUksb0JBQW9CLEdBQUcsY0FBYyxDQUFDLFNBQVMsQ0FDL0MsSUFBSSxDQUFDLDBCQUEwQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FDN0MsQ0FBQztRQUVGLHFCQUFJLGtCQUFrQixHQUFHLFlBQVksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO1lBQ2pELEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7Z0JBQ2xCLGtCQUFrQixDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3JDLElBQUk7Z0JBQ0EsVUFBVSxDQUFDLFdBQVcsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLENBQUMsQ0FBQztTQUN6RCxDQUFDLENBQUM7UUFFSCxNQUFNLENBQUMsY0FBYyxDQUFDOzs7Ozs7SUFHbEIseUJBQXlCLENBQUMsSUFBUztRQUN2QyxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLG9CQUFvQixJQUFJLElBQUksQ0FBQyxPQUFPLElBQUksYUFBYSxDQUFDO1lBQ3JFLE1BQU0sQ0FBQyxJQUFJLENBQUM7Ozs7Ozs7OztJQVVaLGlCQUFpQixDQUFDLElBQVk7UUFDbEMsRUFBRSxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUM7WUFDakQsTUFBTSxDQUFDLElBQUksQ0FBQztRQUVoQixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUNoQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUNyQyxDQUFDOzs7O1lBem1CVCxVQUFVOzs7O1lBekJQLElBQUk7WUFGQyxjQUFjLHVCQWtFZCxRQUFRO1lBbEVRLE1BQU0sdUJBbUV0QixRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBSb3V0ZXIsIENhbkFjdGl2YXRlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7XG4gICAgSHR0cCxcbiAgICBSZXNwb25zZSxcbiAgICBIZWFkZXJzLFxuICAgIFJlcXVlc3QsXG4gICAgUmVxdWVzdE1ldGhvZCxcbiAgICBSZXF1ZXN0T3B0aW9ucyxcbiAgICBSZXF1ZXN0T3B0aW9uc0FyZ3Ncbn0gZnJvbSAnQGFuZ3VsYXIvaHR0cCc7XG5cbmltcG9ydCB7IE9ic2VydmFibGUsIGludGVydmFsLCBmcm9tRXZlbnQgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHNoYXJlLCBwbHVjaywgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQge1xuICAgIFNpZ25JbkRhdGEsXG4gICAgUmVnaXN0ZXJEYXRhLFxuICAgIFVwZGF0ZVBhc3N3b3JkRGF0YSxcbiAgICBSZXNldFBhc3N3b3JkRGF0YSxcblxuICAgIFVzZXJUeXBlLFxuICAgIFVzZXJEYXRhLFxuICAgIEF1dGhEYXRhLFxuXG4gICAgQW5ndWxhcjJUb2tlbk9wdGlvbnNcbn0gZnJvbSAnLi9hbmd1bGFyMi10b2tlbi5tb2RlbCc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBbmd1bGFyMlRva2VuU2VydmljZSBpbXBsZW1lbnRzIENhbkFjdGl2YXRlIHtcblxuICAgIGdldCBjdXJyZW50VXNlclR5cGUoKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHRoaXMuYXRDdXJyZW50VXNlclR5cGUgIT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmF0Q3VycmVudFVzZXJUeXBlLm5hbWU7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGdldCBjdXJyZW50VXNlckRhdGEoKTogVXNlckRhdGEge1xuICAgICAgICByZXR1cm4gdGhpcy5hdEN1cnJlbnRVc2VyRGF0YTtcbiAgICB9XG5cbiAgICBnZXQgY3VycmVudEF1dGhEYXRhKCk6IEF1dGhEYXRhIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXRDdXJyZW50QXV0aERhdGE7XG4gICAgfVxuXG4gICAgZ2V0IGN1cnJlbnRBdXRoSGVhZGVycygpOiBIZWFkZXJzIHtcbiAgICAgICAgaWYgKHRoaXMuYXRDdXJyZW50QXV0aERhdGEgIT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBIZWFkZXJzKHtcbiAgICAgICAgICAgICAgICAnYWNjZXNzLXRva2VuJzogdGhpcy5hdEN1cnJlbnRBdXRoRGF0YS5hY2Nlc3NUb2tlbixcbiAgICAgICAgICAgICAgICAnY2xpZW50JzogICAgICAgdGhpcy5hdEN1cnJlbnRBdXRoRGF0YS5jbGllbnQsXG4gICAgICAgICAgICAgICAgJ2V4cGlyeSc6ICAgICAgIHRoaXMuYXRDdXJyZW50QXV0aERhdGEuZXhwaXJ5LFxuICAgICAgICAgICAgICAgICd0b2tlbi10eXBlJzogICB0aGlzLmF0Q3VycmVudEF1dGhEYXRhLnRva2VuVHlwZSxcbiAgICAgICAgICAgICAgICAndWlkJzogICAgICAgICAgdGhpcy5hdEN1cnJlbnRBdXRoRGF0YS51aWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBIZWFkZXJzO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXRPcHRpb25zOiBBbmd1bGFyMlRva2VuT3B0aW9ucztcbiAgICBwcml2YXRlIGF0Q3VycmVudFVzZXJUeXBlOiBVc2VyVHlwZTtcbiAgICBwcml2YXRlIGF0Q3VycmVudEF1dGhEYXRhOiBBdXRoRGF0YTtcbiAgICBwcml2YXRlIGF0Q3VycmVudFVzZXJEYXRhOiBVc2VyRGF0YTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGh0dHA6IEh0dHAsXG4gICAgICAgIEBPcHRpb25hbCgpIHByaXZhdGUgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLFxuICAgICAgICBAT3B0aW9uYWwoKSBwcml2YXRlIHJvdXRlcjogUm91dGVyXG4gICAgKSB7IH1cblxuICAgIHVzZXJTaWduZWRJbigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5hdEN1cnJlbnRBdXRoRGF0YTtcbiAgICB9XG5cbiAgICBjYW5BY3RpdmF0ZSgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMudXNlclNpZ25lZEluKCkpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBTdG9yZSBjdXJyZW50IGxvY2F0aW9uIGluIHN0b3JhZ2UgKHVzZWZ1bGwgZm9yIHJlZGlyZWN0aW9uIGFmdGVyIHNpZ25pbmcgaW4pXG4gICAgICAgICAgICBpZiAodGhpcy5hdE9wdGlvbnMuc2lnbkluU3RvcmVkVXJsU3RvcmFnZUtleSkge1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmF0T3B0aW9ucy5zaWduSW5TdG9yZWRVcmxTdG9yYWdlS2V5LFxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgKyB3aW5kb3cubG9jYXRpb24uc2VhcmNoXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUmVkaXJlY3QgdXNlciB0byBzaWduIGluIGlmIHNpZ25JblJlZGlyZWN0IGlzIHNldFxuICAgICAgICAgICAgaWYodGhpcy5yb3V0ZXIgJiYgdGhpcy5hdE9wdGlvbnMuc2lnbkluUmVkaXJlY3QpXG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW3RoaXMuYXRPcHRpb25zLnNpZ25JblJlZGlyZWN0XSk7XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIEluaXRhbCBjb25maWd1cmF0aW9uXG4gICAgaW5pdChvcHRpb25zPzogQW5ndWxhcjJUb2tlbk9wdGlvbnMpIHtcblxuICAgICAgICBsZXQgZGVmYXVsdE9wdGlvbnM6IEFuZ3VsYXIyVG9rZW5PcHRpb25zID0ge1xuICAgICAgICAgICAgYXBpUGF0aDogICAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICBhcGlCYXNlOiAgICAgICAgICAgICAgICAgICAgbnVsbCxcblxuICAgICAgICAgICAgc2lnbkluUGF0aDogICAgICAgICAgICAgICAgICdhdXRoL3NpZ25faW4nLFxuICAgICAgICAgICAgc2lnbkluUmVkaXJlY3Q6ICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICBzaWduSW5TdG9yZWRVcmxTdG9yYWdlS2V5OiAgbnVsbCxcblxuICAgICAgICAgICAgc2lnbk91dFBhdGg6ICAgICAgICAgICAgICAgICdhdXRoL3NpZ25fb3V0JyxcbiAgICAgICAgICAgIHZhbGlkYXRlVG9rZW5QYXRoOiAgICAgICAgICAnYXV0aC92YWxpZGF0ZV90b2tlbicsXG4gICAgICAgICAgICBzaWduT3V0RmFpbGVkVmFsaWRhdGU6ICAgICAgZmFsc2UsXG5cbiAgICAgICAgICAgIHJlZ2lzdGVyQWNjb3VudFBhdGg6ICAgICAgICAnYXV0aCcsXG4gICAgICAgICAgICBkZWxldGVBY2NvdW50UGF0aDogICAgICAgICAgJ2F1dGgnLFxuICAgICAgICAgICAgcmVnaXN0ZXJBY2NvdW50Q2FsbGJhY2s6ICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmLFxuXG4gICAgICAgICAgICB1cGRhdGVQYXNzd29yZFBhdGg6ICAgICAgICAgJ2F1dGgnLFxuXG4gICAgICAgICAgICByZXNldFBhc3N3b3JkUGF0aDogICAgICAgICAgJ2F1dGgvcGFzc3dvcmQnLFxuICAgICAgICAgICAgcmVzZXRQYXNzd29yZENhbGxiYWNrOiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmLFxuXG4gICAgICAgICAgICB1c2VyVHlwZXM6ICAgICAgICAgICAgICAgICAgbnVsbCxcblxuICAgICAgICAgICAgb0F1dGhCYXNlOiAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4sXG4gICAgICAgICAgICBvQXV0aFBhdGhzOiB7XG4gICAgICAgICAgICAgICAgZ2l0aHViOiAgICAgICAgICAgICAgICAgJ2F1dGgvZ2l0aHViJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9BdXRoQ2FsbGJhY2tQYXRoOiAgICAgICAgICAnb2F1dGhfY2FsbGJhY2snLFxuICAgICAgICAgICAgb0F1dGhXaW5kb3dUeXBlOiAgICAgICAgICAgICduZXdXaW5kb3cnLFxuICAgICAgICAgICAgb0F1dGhXaW5kb3dPcHRpb25zOiAgICAgICAgIG51bGwsXG5cbiAgICAgICAgICAgIGdsb2JhbE9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgICAgICdBY2NlcHQnOiAgICAgICAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5hdE9wdGlvbnMgPSAoPGFueT5PYmplY3QpLmFzc2lnbihkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cbiAgICAgICAgdGhpcy50cnlMb2FkQXV0aERhdGEoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEFjdGlvbnNcbiAgICAgKlxuICAgICAqL1xuXG4gICAgLy8gUmVnaXN0ZXIgcmVxdWVzdFxuICAgIHJlZ2lzdGVyQWNjb3VudChyZWdpc3RlckRhdGE6IFJlZ2lzdGVyRGF0YSk6IE9ic2VydmFibGU8UmVzcG9uc2U+IHtcblxuICAgICAgICBpZiAocmVnaXN0ZXJEYXRhLnVzZXJUeXBlID09IG51bGwpXG4gICAgICAgICAgICB0aGlzLmF0Q3VycmVudFVzZXJUeXBlID0gbnVsbDtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmF0Q3VycmVudFVzZXJUeXBlID0gdGhpcy5nZXRVc2VyVHlwZUJ5TmFtZShyZWdpc3RlckRhdGEudXNlclR5cGUpO1xuICAgICAgICAgICAgZGVsZXRlIHJlZ2lzdGVyRGF0YS51c2VyVHlwZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHJlZ2lzdGVyRGF0YS5wYXNzd29yZF9jb25maXJtYXRpb24gPT0gbnVsbCAmJiBcbiAgICAgICAgICAgIHJlZ2lzdGVyRGF0YS5wYXNzd29yZENvbmZpcm1hdGlvbiAhPSBudWxsXG4gICAgICAgICkge1xuICAgICAgICAgICAgcmVnaXN0ZXJEYXRhLnBhc3N3b3JkX2NvbmZpcm1hdGlvbiAgPSByZWdpc3RlckRhdGEucGFzc3dvcmRDb25maXJtYXRpb247XG4gICAgICAgICAgICBkZWxldGUgcmVnaXN0ZXJEYXRhLnBhc3N3b3JkQ29uZmlybWF0aW9uO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVnaXN0ZXJEYXRhLmNvbmZpcm1fc3VjY2Vzc191cmwgICAgPSB0aGlzLmF0T3B0aW9ucy5yZWdpc3RlckFjY291bnRDYWxsYmFjaztcblxuICAgICAgICByZXR1cm4gdGhpcy5wb3N0KHRoaXMuZ2V0VXNlclBhdGgoKSArIHRoaXMuYXRPcHRpb25zLnJlZ2lzdGVyQWNjb3VudFBhdGgsIEpTT04uc3RyaW5naWZ5KHJlZ2lzdGVyRGF0YSkpO1xuICAgIH1cblxuICAgIC8vIERlbGV0ZSBBY2NvdW50XG4gICAgZGVsZXRlQWNjb3VudCgpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlbGV0ZSh0aGlzLmdldFVzZXJQYXRoKCkgKyB0aGlzLmF0T3B0aW9ucy5kZWxldGVBY2NvdW50UGF0aCk7XG4gICAgfVxuXG4gICAgLy8gU2lnbiBpbiByZXF1ZXN0IGFuZCBzZXQgc3RvcmFnZVxuICAgIHNpZ25JbihzaWduSW5EYXRhOiBTaWduSW5EYXRhKTogT2JzZXJ2YWJsZTxSZXNwb25zZT4ge1xuXG4gICAgICAgIGlmIChzaWduSW5EYXRhLnVzZXJUeXBlID09IG51bGwpXG4gICAgICAgICAgICB0aGlzLmF0Q3VycmVudFVzZXJUeXBlID0gbnVsbDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5hdEN1cnJlbnRVc2VyVHlwZSA9IHRoaXMuZ2V0VXNlclR5cGVCeU5hbWUoc2lnbkluRGF0YS51c2VyVHlwZSk7XG5cbiAgICAgICAgbGV0IGJvZHkgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBlbWFpbDogICAgICBzaWduSW5EYXRhLmVtYWlsLFxuICAgICAgICAgICAgcGFzc3dvcmQ6ICAgc2lnbkluRGF0YS5wYXNzd29yZFxuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgb2JzZXJ2ID0gdGhpcy5wb3N0KHRoaXMuZ2V0VXNlclBhdGgoKSArIHRoaXMuYXRPcHRpb25zLnNpZ25JblBhdGgsIGJvZHkpO1xuXG4gICAgICAgIG9ic2Vydi5zdWJzY3JpYmUocmVzID0+IHRoaXMuYXRDdXJyZW50VXNlckRhdGEgPSByZXMuanNvbigpLmRhdGEsIF9lcnJvciA9PiBudWxsKTtcblxuICAgICAgICByZXR1cm4gb2JzZXJ2O1xuICAgIH1cblxuICAgIHNpZ25Jbk9BdXRoKG9BdXRoVHlwZTogc3RyaW5nKSB7XG5cbiAgICAgICAgbGV0IG9BdXRoUGF0aDogc3RyaW5nID0gdGhpcy5nZXRPQXV0aFBhdGgob0F1dGhUeXBlKTtcbiAgICAgICAgbGV0IGNhbGxiYWNrVXJsOiBzdHJpbmcgPSBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufS8ke3RoaXMuYXRPcHRpb25zLm9BdXRoQ2FsbGJhY2tQYXRofWA7XG4gICAgICAgIGxldCBvQXV0aFdpbmRvd1R5cGU6IHN0cmluZyA9IHRoaXMuYXRPcHRpb25zLm9BdXRoV2luZG93VHlwZTtcbiAgICAgICAgbGV0IGF1dGhVcmw6IHN0cmluZyA9IHRoaXMuZ2V0T0F1dGhVcmwob0F1dGhQYXRoLCBjYWxsYmFja1VybCwgb0F1dGhXaW5kb3dUeXBlKTtcblxuICAgICAgICBpZiAob0F1dGhXaW5kb3dUeXBlID09ICduZXdXaW5kb3cnKSB7XG4gICAgICAgICAgICBsZXQgb0F1dGhXaW5kb3dPcHRpb25zID0gdGhpcy5hdE9wdGlvbnMub0F1dGhXaW5kb3dPcHRpb25zO1xuICAgICAgICAgICAgbGV0IHdpbmRvd09wdGlvbnMgPSAnJztcblxuICAgICAgICAgICAgaWYgKG9BdXRoV2luZG93T3B0aW9ucykge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiBvQXV0aFdpbmRvd09wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93T3B0aW9ucyArPSBgLCR7a2V5fT0ke29BdXRoV2luZG93T3B0aW9uc1trZXldfWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgcG9wdXAgPSB3aW5kb3cub3BlbihcbiAgICAgICAgICAgICAgICBhdXRoVXJsLFxuICAgICAgICAgICAgICAgICdfYmxhbmsnLFxuICAgICAgICAgICAgICAgIGBjbG9zZWJ1dHRvbmNhcHRpb249Q2FuY2VsJHt3aW5kb3dPcHRpb25zfWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0Q3JlZGVudGlhbHNWaWFQb3N0TWVzc2FnZShwb3B1cCk7XG4gICAgICAgIH0gZWxzZSBpZiAob0F1dGhXaW5kb3dUeXBlID09ICdzYW1lV2luZG93Jykge1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBhdXRoVXJsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgYFVuc3VwcG9ydGVkIG9BdXRoV2luZG93VHlwZSBcIiR7b0F1dGhXaW5kb3dUeXBlfVwiYDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb2Nlc3NPQXV0aENhbGxiYWNrKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmdldEF1dGhEYXRhRnJvbVBhcmFtcygpO1xuICAgIH1cblxuICAgIC8vIFNpZ24gb3V0IHJlcXVlc3QgYW5kIGRlbGV0ZSBzdG9yYWdlXG4gICAgc2lnbk91dCgpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPiB7XG4gICAgICAgIGxldCBvYnNlcnYgPSB0aGlzLmRlbGV0ZSh0aGlzLmdldFVzZXJQYXRoKCkgKyB0aGlzLmF0T3B0aW9ucy5zaWduT3V0UGF0aCk7XG5cbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2FjY2Vzc1Rva2VuJyk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdjbGllbnQnKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2V4cGlyeScpO1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndG9rZW5UeXBlJyk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd1aWQnKTtcblxuICAgICAgICB0aGlzLmF0Q3VycmVudEF1dGhEYXRhID0gbnVsbDtcbiAgICAgICAgdGhpcy5hdEN1cnJlbnRVc2VyVHlwZSA9IG51bGw7XG4gICAgICAgIHRoaXMuYXRDdXJyZW50VXNlckRhdGEgPSBudWxsO1xuXG4gICAgICAgIHJldHVybiBvYnNlcnY7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgdG9rZW4gcmVxdWVzdFxuICAgIHZhbGlkYXRlVG9rZW4oKTogT2JzZXJ2YWJsZTxSZXNwb25zZT4ge1xuICAgICAgICBsZXQgb2JzZXJ2ID0gdGhpcy5nZXQodGhpcy5nZXRVc2VyUGF0aCgpICsgdGhpcy5hdE9wdGlvbnMudmFsaWRhdGVUb2tlblBhdGgpO1xuXG4gICAgICAgIG9ic2Vydi5zdWJzY3JpYmUoXG4gICAgICAgICAgICByZXMgPT4gdGhpcy5hdEN1cnJlbnRVc2VyRGF0YSA9IHJlcy5qc29uKCkuZGF0YSxcbiAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3Iuc3RhdHVzID09PSA0MDEgJiYgdGhpcy5hdE9wdGlvbnMuc2lnbk91dEZhaWxlZFZhbGlkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2lnbk91dCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBvYnNlcnY7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHBhc3N3b3JkIHJlcXVlc3RcbiAgICB1cGRhdGVQYXNzd29yZCh1cGRhdGVQYXNzd29yZERhdGE6IFVwZGF0ZVBhc3N3b3JkRGF0YSk6IE9ic2VydmFibGU8UmVzcG9uc2U+IHtcblxuICAgICAgICBpZiAodXBkYXRlUGFzc3dvcmREYXRhLnVzZXJUeXBlICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLmF0Q3VycmVudFVzZXJUeXBlID0gdGhpcy5nZXRVc2VyVHlwZUJ5TmFtZSh1cGRhdGVQYXNzd29yZERhdGEudXNlclR5cGUpO1xuXG4gICAgICAgIGxldCBhcmdzOiBhbnk7XG5cbiAgICAgICAgaWYgKHVwZGF0ZVBhc3N3b3JkRGF0YS5wYXNzd29yZEN1cnJlbnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgYXJncyA9IHtcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogICAgICAgICAgICAgICB1cGRhdGVQYXNzd29yZERhdGEucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmRfY29uZmlybWF0aW9uOiAgdXBkYXRlUGFzc3dvcmREYXRhLnBhc3N3b3JkQ29uZmlybWF0aW9uXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhcmdzID0ge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRfcGFzc3dvcmQ6ICAgICAgIHVwZGF0ZVBhc3N3b3JkRGF0YS5wYXNzd29yZEN1cnJlbnQsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICAgICAgICAgICAgICAgdXBkYXRlUGFzc3dvcmREYXRhLnBhc3N3b3JkLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkX2NvbmZpcm1hdGlvbjogIHVwZGF0ZVBhc3N3b3JkRGF0YS5wYXNzd29yZENvbmZpcm1hdGlvblxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh1cGRhdGVQYXNzd29yZERhdGEucmVzZXRQYXNzd29yZFRva2VuKSB7XG4gICAgICAgICAgICBhcmdzLnJlc2V0X3Bhc3N3b3JkX3Rva2VuID0gdXBkYXRlUGFzc3dvcmREYXRhLnJlc2V0UGFzc3dvcmRUb2tlbjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBib2R5ID0gSlNPTi5zdHJpbmdpZnkoYXJncyk7XG4gICAgICAgIHJldHVybiB0aGlzLnB1dCh0aGlzLmdldFVzZXJQYXRoKCkgKyB0aGlzLmF0T3B0aW9ucy51cGRhdGVQYXNzd29yZFBhdGgsIGJvZHkpO1xuICAgIH1cblxuICAgIC8vIFJlc2V0IHBhc3N3b3JkIHJlcXVlc3RcbiAgICByZXNldFBhc3N3b3JkKHJlc2V0UGFzc3dvcmREYXRhOiBSZXNldFBhc3N3b3JkRGF0YSk6IE9ic2VydmFibGU8UmVzcG9uc2U+IHtcblxuICAgICAgICBpZiAocmVzZXRQYXNzd29yZERhdGEudXNlclR5cGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuYXRDdXJyZW50VXNlclR5cGUgPSBudWxsO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLmF0Q3VycmVudFVzZXJUeXBlID0gdGhpcy5nZXRVc2VyVHlwZUJ5TmFtZShyZXNldFBhc3N3b3JkRGF0YS51c2VyVHlwZSk7XG5cbiAgICAgICAgbGV0IGJvZHkgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBlbWFpbDogICAgICAgICAgcmVzZXRQYXNzd29yZERhdGEuZW1haWwsXG4gICAgICAgICAgICByZWRpcmVjdF91cmw6ICAgdGhpcy5hdE9wdGlvbnMucmVzZXRQYXNzd29yZENhbGxiYWNrXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzLnBvc3QodGhpcy5nZXRVc2VyUGF0aCgpICsgdGhpcy5hdE9wdGlvbnMucmVzZXRQYXNzd29yZFBhdGgsIGJvZHkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogSFRUUCBXcmFwcGVyc1xuICAgICAqXG4gICAgICovXG5cbiAgICBnZXQodXJsOiBzdHJpbmcsIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc0FyZ3MpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QodGhpcy5tZXJnZVJlcXVlc3RPcHRpb25zQXJncyh7XG4gICAgICAgICAgICB1cmw6ICAgIHRoaXMuZ2V0QXBpUGF0aCgpICsgdXJsLFxuICAgICAgICAgICAgbWV0aG9kOiBSZXF1ZXN0TWV0aG9kLkdldFxuICAgICAgICB9LCBvcHRpb25zKSk7XG4gICAgfVxuXG4gICAgcG9zdCh1cmw6IHN0cmluZywgYm9keTogYW55LCBvcHRpb25zPzogUmVxdWVzdE9wdGlvbnNBcmdzKTogT2JzZXJ2YWJsZTxSZXNwb25zZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHRoaXMubWVyZ2VSZXF1ZXN0T3B0aW9uc0FyZ3Moe1xuICAgICAgICAgICAgdXJsOiAgICB0aGlzLmdldEFwaVBhdGgoKSArIHVybCxcbiAgICAgICAgICAgIG1ldGhvZDogUmVxdWVzdE1ldGhvZC5Qb3N0LFxuICAgICAgICAgICAgYm9keTogICBib2R5XG4gICAgICAgIH0sIG9wdGlvbnMpKTtcbiAgICB9XG5cbiAgICBwdXQodXJsOiBzdHJpbmcsIGJvZHk6IGFueSwgb3B0aW9ucz86IFJlcXVlc3RPcHRpb25zQXJncyk6IE9ic2VydmFibGU8UmVzcG9uc2U+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCh0aGlzLm1lcmdlUmVxdWVzdE9wdGlvbnNBcmdzKHtcbiAgICAgICAgICAgIHVybDogICAgdGhpcy5nZXRBcGlQYXRoKCkgKyB1cmwsXG4gICAgICAgICAgICBtZXRob2Q6IFJlcXVlc3RNZXRob2QuUHV0LFxuICAgICAgICAgICAgYm9keTogICBib2R5XG4gICAgICAgIH0sIG9wdGlvbnMpKTtcbiAgICB9XG5cbiAgICBkZWxldGUodXJsOiBzdHJpbmcsIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc0FyZ3MpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QodGhpcy5tZXJnZVJlcXVlc3RPcHRpb25zQXJncyh7XG4gICAgICAgICAgICB1cmw6ICAgIHRoaXMuZ2V0QXBpUGF0aCgpICsgdXJsLFxuICAgICAgICAgICAgbWV0aG9kOiBSZXF1ZXN0TWV0aG9kLkRlbGV0ZVxuICAgICAgICB9LCBvcHRpb25zKSk7XG4gICAgfVxuXG4gICAgcGF0Y2godXJsOiBzdHJpbmcsIGJvZHk6IGFueSwgb3B0aW9ucz86IFJlcXVlc3RPcHRpb25zQXJncyk6IE9ic2VydmFibGU8UmVzcG9uc2U+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCh0aGlzLm1lcmdlUmVxdWVzdE9wdGlvbnNBcmdzKHtcbiAgICAgICAgICAgIHVybDogICAgdGhpcy5nZXRBcGlQYXRoKCkgKyB1cmwsXG4gICAgICAgICAgICBtZXRob2Q6IFJlcXVlc3RNZXRob2QuUGF0Y2gsXG4gICAgICAgICAgICBib2R5OiAgIGJvZHlcbiAgICAgICAgfSwgb3B0aW9ucykpO1xuICAgIH1cblxuICAgIGhlYWQocGF0aDogc3RyaW5nLCBvcHRpb25zPzogUmVxdWVzdE9wdGlvbnNBcmdzKTogT2JzZXJ2YWJsZTxSZXNwb25zZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgICAgICAgIG1ldGhvZDogUmVxdWVzdE1ldGhvZC5IZWFkLFxuICAgICAgICAgICAgdXJsOiAgICB0aGlzLmdldEFwaVBhdGgoKSArIHBhdGhcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb3B0aW9ucyh1cmw6IHN0cmluZywgb3B0aW9ucz86IFJlcXVlc3RPcHRpb25zQXJncyk6IE9ic2VydmFibGU8UmVzcG9uc2U+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCh0aGlzLm1lcmdlUmVxdWVzdE9wdGlvbnNBcmdzKHtcbiAgICAgICAgICAgIHVybDogICAgdGhpcy5nZXRBcGlQYXRoKCkgKyB1cmwsXG4gICAgICAgICAgICBtZXRob2Q6IFJlcXVlc3RNZXRob2QuT3B0aW9uc1xuICAgICAgICB9LCBvcHRpb25zKSk7XG4gICAgfVxuXG4gICAgLy8gQ29uc3RydWN0IGFuZCBzZW5kIEh0dHAgcmVxdWVzdFxuICAgIHJlcXVlc3Qob3B0aW9uczogUmVxdWVzdE9wdGlvbnNBcmdzKTogT2JzZXJ2YWJsZTxSZXNwb25zZT4ge1xuXG4gICAgICAgIGxldCBiYXNlUmVxdWVzdE9wdGlvbnM6IFJlcXVlc3RPcHRpb25zO1xuICAgICAgICBsZXQgYmFzZUhlYWRlcnM6ICAgICAgICB7IFtrZXk6c3RyaW5nXTogc3RyaW5nOyB9ID0gdGhpcy5hdE9wdGlvbnMuZ2xvYmFsT3B0aW9ucy5oZWFkZXJzO1xuXG4gICAgICAgIC8vIEdldCBhdXRoIGRhdGEgZnJvbSBsb2NhbCBzdG9yYWdlXG4gICAgICAgIHRoaXMuZ2V0QXV0aERhdGFGcm9tU3RvcmFnZSgpO1xuICAgICAgICBcbiAgICAgICAgLy8gTWVyZ2UgYXV0aCBoZWFkZXJzIHRvIHJlcXVlc3QgaWYgc2V0XG4gICAgICAgIGlmICh0aGlzLmF0Q3VycmVudEF1dGhEYXRhICE9IG51bGwpIHtcbiAgICAgICAgICAgICg8YW55Pk9iamVjdCkuYXNzaWduKGJhc2VIZWFkZXJzLCB7XG4gICAgICAgICAgICAgICAgJ2FjY2Vzcy10b2tlbic6IHRoaXMuYXRDdXJyZW50QXV0aERhdGEuYWNjZXNzVG9rZW4sXG4gICAgICAgICAgICAgICAgJ2NsaWVudCc6ICAgICAgIHRoaXMuYXRDdXJyZW50QXV0aERhdGEuY2xpZW50LFxuICAgICAgICAgICAgICAgICdleHBpcnknOiAgICAgICB0aGlzLmF0Q3VycmVudEF1dGhEYXRhLmV4cGlyeSxcbiAgICAgICAgICAgICAgICAndG9rZW4tdHlwZSc6ICAgdGhpcy5hdEN1cnJlbnRBdXRoRGF0YS50b2tlblR5cGUsXG4gICAgICAgICAgICAgICAgJ3VpZCc6ICAgICAgICAgIHRoaXMuYXRDdXJyZW50QXV0aERhdGEudWlkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJhc2VSZXF1ZXN0T3B0aW9ucyA9IG5ldyBSZXF1ZXN0T3B0aW9ucyh7XG4gICAgICAgICAgICBoZWFkZXJzOiBuZXcgSGVhZGVycyhiYXNlSGVhZGVycylcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gTWVyZ2Ugc3RhbmRhcmQgYW5kIGN1c3RvbSBSZXF1ZXN0T3B0aW9uc1xuICAgICAgICBiYXNlUmVxdWVzdE9wdGlvbnMgPSBiYXNlUmVxdWVzdE9wdGlvbnMubWVyZ2Uob3B0aW9ucyk7XG5cbiAgICAgICAgbGV0IHJlc3BvbnNlID0gdGhpcy5odHRwLnJlcXVlc3QobmV3IFJlcXVlc3QoYmFzZVJlcXVlc3RPcHRpb25zKSkucGlwZShzaGFyZSgpKTtcbiAgICAgICAgdGhpcy5oYW5kbGVSZXNwb25zZShyZXNwb25zZSk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgbWVyZ2VSZXF1ZXN0T3B0aW9uc0FyZ3Mob3B0aW9uczogUmVxdWVzdE9wdGlvbnNBcmdzLCBhZGRPcHRpb25zPzogUmVxdWVzdE9wdGlvbnNBcmdzKTogUmVxdWVzdE9wdGlvbnNBcmdzIHtcblxuICAgICAgICBsZXQgcmV0dXJuT3B0aW9uczogUmVxdWVzdE9wdGlvbnNBcmdzID0gb3B0aW9ucztcblxuICAgICAgICBpZiAob3B0aW9ucylcbiAgICAgICAgICAgICg8YW55Pk9iamVjdCkuYXNzaWduKHJldHVybk9wdGlvbnMsIGFkZE9wdGlvbnMpO1xuXG4gICAgICAgIHJldHVybiByZXR1cm5PcHRpb25zO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIHJlc3BvbnNlIGlzIGNvbXBsZXRlIGFuZCBuZXdlciwgdGhlbiB1cGRhdGUgc3RvcmFnZVxuICAgIHByaXZhdGUgaGFuZGxlUmVzcG9uc2UocmVzcG9uc2U6IE9ic2VydmFibGU8UmVzcG9uc2U+KTogdm9pZCB7XG4gICAgICAgIHJlc3BvbnNlLnN1YnNjcmliZShyZXMgPT4ge1xuICAgICAgICAgICAgdGhpcy5nZXRBdXRoSGVhZGVyc0Zyb21SZXNwb25zZSg8YW55PnJlcyk7XG4gICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMuZ2V0QXV0aEhlYWRlcnNGcm9tUmVzcG9uc2UoPGFueT5lcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogR2V0IEF1dGggRGF0YVxuICAgICAqXG4gICAgICovXG5cbiAgICAvLyBUcnkgdG8gbG9hZCBhdXRoIGRhdGFcbiAgICBwcml2YXRlIHRyeUxvYWRBdXRoRGF0YSgpOiB2b2lkIHtcblxuICAgICAgICBsZXQgdXNlclR5cGUgPSB0aGlzLmdldFVzZXJUeXBlQnlOYW1lKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyVHlwZScpKTtcblxuICAgICAgICBpZiAodXNlclR5cGUpXG4gICAgICAgICAgICB0aGlzLmF0Q3VycmVudFVzZXJUeXBlID0gdXNlclR5cGU7XG5cbiAgICAgICAgdGhpcy5nZXRBdXRoRGF0YUZyb21TdG9yYWdlKCk7XG5cbiAgICAgICAgaWYodGhpcy5hY3RpdmF0ZWRSb3V0ZSlcbiAgICAgICAgICAgIHRoaXMuZ2V0QXV0aERhdGFGcm9tUGFyYW1zKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuYXRDdXJyZW50QXV0aERhdGEpXG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRlVG9rZW4oKTtcbiAgICB9XG5cbiAgICAvLyBQYXJzZSBBdXRoIGRhdGEgZnJvbSByZXNwb25zZVxuICAgIHByaXZhdGUgZ2V0QXV0aEhlYWRlcnNGcm9tUmVzcG9uc2UoZGF0YTogYW55KTogdm9pZCB7XG4gICAgICAgIGxldCBoZWFkZXJzID0gZGF0YS5oZWFkZXJzO1xuXG4gICAgICAgIGxldCBhdXRoRGF0YTogQXV0aERhdGEgPSB7XG4gICAgICAgICAgICBhY2Nlc3NUb2tlbjogICAgaGVhZGVycy5nZXQoJ2FjY2Vzcy10b2tlbicpLFxuICAgICAgICAgICAgY2xpZW50OiAgICAgICAgIGhlYWRlcnMuZ2V0KCdjbGllbnQnKSxcbiAgICAgICAgICAgIGV4cGlyeTogICAgICAgICBoZWFkZXJzLmdldCgnZXhwaXJ5JyksXG4gICAgICAgICAgICB0b2tlblR5cGU6ICAgICAgaGVhZGVycy5nZXQoJ3Rva2VuLXR5cGUnKSxcbiAgICAgICAgICAgIHVpZDogICAgICAgICAgICBoZWFkZXJzLmdldCgndWlkJylcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnNldEF1dGhEYXRhKGF1dGhEYXRhKTtcbiAgICB9XG5cbiAgICAvLyBQYXJzZSBBdXRoIGRhdGEgZnJvbSBwb3N0IG1lc3NhZ2VcbiAgICBwcml2YXRlIGdldEF1dGhEYXRhRnJvbVBvc3RNZXNzYWdlKGRhdGE6IGFueSk6IHZvaWQge1xuICAgICAgICBsZXQgYXV0aERhdGE6IEF1dGhEYXRhID0ge1xuICAgICAgICAgICAgYWNjZXNzVG9rZW46ICAgIGRhdGFbJ2F1dGhfdG9rZW4nXSxcbiAgICAgICAgICAgIGNsaWVudDogICAgICAgICBkYXRhWydjbGllbnRfaWQnXSxcbiAgICAgICAgICAgIGV4cGlyeTogICAgICAgICBkYXRhWydleHBpcnknXSxcbiAgICAgICAgICAgIHRva2VuVHlwZTogICAgICAnQmVhcmVyJyxcbiAgICAgICAgICAgIHVpZDogICAgICAgICAgICBkYXRhWyd1aWQnXVxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuc2V0QXV0aERhdGEoYXV0aERhdGEpO1xuICAgIH1cblxuICAgIC8vIFRyeSB0byBnZXQgYXV0aCBkYXRhIGZyb20gc3RvcmFnZS5cbiAgICBwcml2YXRlIGdldEF1dGhEYXRhRnJvbVN0b3JhZ2UoKTogdm9pZCB7XG5cbiAgICAgICAgbGV0IGF1dGhEYXRhOiBBdXRoRGF0YSA9IHtcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzVG9rZW4nKSxcbiAgICAgICAgICAgIGNsaWVudDogICAgICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY2xpZW50JyksXG4gICAgICAgICAgICBleHBpcnk6ICAgICAgICAgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2V4cGlyeScpLFxuICAgICAgICAgICAgdG9rZW5UeXBlOiAgICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlblR5cGUnKSxcbiAgICAgICAgICAgIHVpZDogICAgICAgICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndWlkJylcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAodGhpcy5jaGVja0F1dGhEYXRhKGF1dGhEYXRhKSlcbiAgICAgICAgICAgIHRoaXMuYXRDdXJyZW50QXV0aERhdGEgPSBhdXRoRGF0YTtcbiAgICB9XG5cbiAgICAvLyBUcnkgdG8gZ2V0IGF1dGggZGF0YSBmcm9tIHVybCBwYXJhbWV0ZXJzLlxuICAgIHByaXZhdGUgZ2V0QXV0aERhdGFGcm9tUGFyYW1zKCk6IHZvaWQge1xuICAgICAgICBpZih0aGlzLmFjdGl2YXRlZFJvdXRlLnF1ZXJ5UGFyYW1zKSAvLyBGaXggZm9yIFRlc3RpbmcsIG5lZWRzIHRvIGJlIHJlbW92ZWQgbGF0ZXJcbiAgICAgICAgICAgIHRoaXMuYWN0aXZhdGVkUm91dGUucXVlcnlQYXJhbXMuc3Vic2NyaWJlKHF1ZXJ5UGFyYW1zID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgYXV0aERhdGE6IEF1dGhEYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbjogICAgcXVlcnlQYXJhbXNbJ3Rva2VuJ10gfHwgcXVlcnlQYXJhbXNbJ2F1dGhfdG9rZW4nXSxcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50OiAgICAgICAgIHF1ZXJ5UGFyYW1zWydjbGllbnRfaWQnXSxcbiAgICAgICAgICAgICAgICAgICAgZXhwaXJ5OiAgICAgICAgIHF1ZXJ5UGFyYW1zWydleHBpcnknXSxcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5UeXBlOiAgICAgICdCZWFyZXInLFxuICAgICAgICAgICAgICAgICAgICB1aWQ6ICAgICAgICAgICAgcXVlcnlQYXJhbXNbJ3VpZCddXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrQXV0aERhdGEoYXV0aERhdGEpKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmF0Q3VycmVudEF1dGhEYXRhID0gYXV0aERhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIFNldCBBdXRoIERhdGFcbiAgICAgKlxuICAgICAqL1xuXG4gICAgLy8gV3JpdGUgYXV0aCBkYXRhIHRvIHN0b3JhZ2VcbiAgICBwcml2YXRlIHNldEF1dGhEYXRhKGF1dGhEYXRhOiBBdXRoRGF0YSk6IHZvaWQge1xuXG4gICAgICAgIGlmICh0aGlzLmNoZWNrQXV0aERhdGEoYXV0aERhdGEpKSB7XG5cbiAgICAgICAgICAgIHRoaXMuYXRDdXJyZW50QXV0aERhdGEgPSBhdXRoRGF0YTtcblxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2FjY2Vzc1Rva2VuJywgYXV0aERhdGEuYWNjZXNzVG9rZW4pO1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NsaWVudCcsIGF1dGhEYXRhLmNsaWVudCk7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZXhwaXJ5JywgYXV0aERhdGEuZXhwaXJ5KTtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0b2tlblR5cGUnLCBhdXRoRGF0YS50b2tlblR5cGUpO1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3VpZCcsIGF1dGhEYXRhLnVpZCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmF0Q3VycmVudFVzZXJUeXBlICE9IG51bGwpXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3VzZXJUeXBlJywgdGhpcy5hdEN1cnJlbnRVc2VyVHlwZS5uYW1lKTtcblxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBWYWxpZGF0ZSBBdXRoIERhdGFcbiAgICAgKlxuICAgICAqL1xuXG4gICAgLy8gQ2hlY2sgaWYgYXV0aCBkYXRhIGNvbXBsZXRlIGFuZCBpZiByZXNwb25zZSB0b2tlbiBpcyBuZXdlclxuICAgIHByaXZhdGUgY2hlY2tBdXRoRGF0YShhdXRoRGF0YTogQXV0aERhdGEpOiBib29sZWFuIHtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgICBhdXRoRGF0YS5hY2Nlc3NUb2tlbiAhPSBudWxsICYmXG4gICAgICAgICAgICBhdXRoRGF0YS5jbGllbnQgIT0gbnVsbCAmJlxuICAgICAgICAgICAgYXV0aERhdGEuZXhwaXJ5ICE9IG51bGwgJiZcbiAgICAgICAgICAgIGF1dGhEYXRhLnRva2VuVHlwZSAhPSBudWxsICYmXG4gICAgICAgICAgICBhdXRoRGF0YS51aWQgIT0gbnVsbFxuICAgICAgICApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmF0Q3VycmVudEF1dGhEYXRhICE9IG51bGwpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGF1dGhEYXRhLmV4cGlyeSA+PSB0aGlzLmF0Q3VycmVudEF1dGhEYXRhLmV4cGlyeTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQ29uc3RydWN0IFBhdGhzIC8gVXJsc1xuICAgICAqXG4gICAgICovXG5cbiAgICBwcml2YXRlIGdldFVzZXJQYXRoKCk6IHN0cmluZyB7XG4gICAgICAgIGlmICh0aGlzLmF0Q3VycmVudFVzZXJUeXBlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmF0Q3VycmVudFVzZXJUeXBlLnBhdGggKyAnLyc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRBcGlQYXRoKCk6IHN0cmluZyB7XG4gICAgICAgIGxldCBjb25zdHJ1Y3RlZFBhdGggPSAnJztcblxuICAgICAgICBpZiAodGhpcy5hdE9wdGlvbnMuYXBpQmFzZSAhPSBudWxsKVxuICAgICAgICAgICAgY29uc3RydWN0ZWRQYXRoICs9IHRoaXMuYXRPcHRpb25zLmFwaUJhc2UgKyAnLyc7XG5cbiAgICAgICAgaWYgKHRoaXMuYXRPcHRpb25zLmFwaVBhdGggIT0gbnVsbClcbiAgICAgICAgICAgIGNvbnN0cnVjdGVkUGF0aCArPSB0aGlzLmF0T3B0aW9ucy5hcGlQYXRoICsgJy8nO1xuXG4gICAgICAgIHJldHVybiBjb25zdHJ1Y3RlZFBhdGg7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRPQXV0aFBhdGgob0F1dGhUeXBlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBsZXQgb0F1dGhQYXRoOiBzdHJpbmc7XG5cbiAgICAgICAgb0F1dGhQYXRoID0gdGhpcy5hdE9wdGlvbnMub0F1dGhQYXRoc1tvQXV0aFR5cGVdO1xuXG4gICAgICAgIGlmIChvQXV0aFBhdGggPT0gbnVsbClcbiAgICAgICAgICAgIG9BdXRoUGF0aCA9IGAvYXV0aC8ke29BdXRoVHlwZX1gO1xuXG4gICAgICAgIHJldHVybiBvQXV0aFBhdGg7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRPQXV0aFVybChvQXV0aFBhdGg6IHN0cmluZywgY2FsbGJhY2tVcmw6IHN0cmluZywgd2luZG93VHlwZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IHVybDogc3RyaW5nO1xuXG4gICAgICAgIHVybCA9ICAgYCR7dGhpcy5hdE9wdGlvbnMub0F1dGhCYXNlfS8ke29BdXRoUGF0aH1gO1xuICAgICAgICB1cmwgKz0gIGA/b21uaWF1dGhfd2luZG93X3R5cGU9JHt3aW5kb3dUeXBlfWA7XG4gICAgICAgIHVybCArPSAgYCZhdXRoX29yaWdpbl91cmw9JHtlbmNvZGVVUklDb21wb25lbnQoY2FsbGJhY2tVcmwpfWA7XG5cbiAgICAgICAgaWYgKHRoaXMuYXRDdXJyZW50VXNlclR5cGUgIT0gbnVsbClcbiAgICAgICAgICAgIHVybCArPSBgJnJlc291cmNlX2NsYXNzPSR7dGhpcy5hdEN1cnJlbnRVc2VyVHlwZS5uYW1lfWA7XG5cbiAgICAgICAgcmV0dXJuIHVybDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIE9BdXRoXG4gICAgICpcbiAgICAgKi9cblxuICAgIHByaXZhdGUgcmVxdWVzdENyZWRlbnRpYWxzVmlhUG9zdE1lc3NhZ2UoYXV0aFdpbmRvdzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgbGV0IHBvbGxlck9ic2VydiA9IGludGVydmFsKDUwMCk7XG5cbiAgICAgICAgbGV0IHJlc3BvbnNlT2JzZXJ2ID0gZnJvbUV2ZW50KHdpbmRvdywgJ21lc3NhZ2UnKS5waXBlKFxuICAgICAgICAgICAgcGx1Y2soJ2RhdGEnKSxcbiAgICAgICAgICAgIGZpbHRlcih0aGlzLm9BdXRoV2luZG93UmVzcG9uc2VGaWx0ZXIpXG4gICAgICAgICk7XG5cbiAgICAgICAgbGV0IHJlc3BvbnNlU3Vic2NyaXB0aW9uID0gcmVzcG9uc2VPYnNlcnYuc3Vic2NyaWJlKFxuICAgICAgICAgICAgdGhpcy5nZXRBdXRoRGF0YUZyb21Qb3N0TWVzc2FnZS5iaW5kKHRoaXMpXG4gICAgICAgICk7XG5cbiAgICAgICAgbGV0IHBvbGxlclN1YnNjcmlwdGlvbiA9IHBvbGxlck9ic2Vydi5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGF1dGhXaW5kb3cuY2xvc2VkKVxuICAgICAgICAgICAgICAgIHBvbGxlclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGF1dGhXaW5kb3cucG9zdE1lc3NhZ2UoJ3JlcXVlc3RDcmVkZW50aWFscycsICcqJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiByZXNwb25zZU9ic2VydjtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9BdXRoV2luZG93UmVzcG9uc2VGaWx0ZXIoZGF0YTogYW55KTogYW55IHtcbiAgICAgICAgaWYoZGF0YS5tZXNzYWdlID09ICdkZWxpdmVyQ3JlZGVudGlhbHMnIHx8IGRhdGEubWVzc2FnZSA9PSAnYXV0aEZhaWx1cmUnKVxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBVdGlsaXRpZXNcbiAgICAgKlxuICAgICAqL1xuXG4gICAgLy8gTWF0Y2ggdXNlciBjb25maWcgYnkgdXNlciBjb25maWcgbmFtZVxuICAgIHByaXZhdGUgZ2V0VXNlclR5cGVCeU5hbWUobmFtZTogc3RyaW5nKTogVXNlclR5cGUge1xuICAgICAgICBpZiAobmFtZSA9PSBudWxsIHx8IHRoaXMuYXRPcHRpb25zLnVzZXJUeXBlcyA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuYXRPcHRpb25zLnVzZXJUeXBlcy5maW5kKFxuICAgICAgICAgICAgdXNlclR5cGUgPT4gdXNlclR5cGUubmFtZSA9PT0gbmFtZVxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==